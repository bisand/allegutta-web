# Copilot Instructions for AlleGutta Portfolio

## Project Overview
AlleGutta Portfolio is a modern portfolio management application for tracking investments, transactions, and portfolio analytics.

## Technology Stack
- **Language**: TypeScript
- **Framework**: Nuxt 4 (Vue 3)
- **Package Manager**: pnpm
- **Database**: SQLite (dev) / PostgreSQL (production)
- **ORM**: Prisma
- **Styling**: Tailwind CSS + Nuxt UI
- **Authentication**: Kinde
- **State Management**: Pinia

## Development Guidelines

### Keep It Simple
- Focus on clarity over complexity
- Use standard patterns and conventions
- Prefer composition over inheritance
- Write self-documenting code with meaningful names

### Code Style
- Use TypeScript for all new code
- Follow Vue 3 Composition API patterns
- Use Nuxt auto-imports (no manual imports for Vue/Nuxt utilities)
- Prefer `const` over `let`, avoid `var`
- Use descriptive variable and function names

### File Structure
```
app/
├── components/     # Vue components
├── composables/    # Reusable composition functions
├── layouts/        # Page layouts
├── middleware/     # Route middleware
├── pages/          # File-based routing
├── plugins/        # Nuxt plugins
└── stores/         # Pinia stores

server/
├── api/           # API routes
├── lib/           # Server utilities
└── plugins/       # Server plugins

prisma/
├── schema.prisma  # Database schema
└── migrations/    # Database migrations
```

## Development Commands

### Starting Development
```bash
# Start dev server in background (recommended for testing)
pnpm dev &

# Start dev server directly (blocks terminal)
pnpm dev

# Note: All following commands will break out of running dev server
# Use background mode (&) when testing with curl or shell scripts
```

### Database Operations
```bash
# Initialize database
pnpm db:init

# Seed database with sample data
pnpm db:seed

# Apply migrations
npx prisma migrate dev

# View database
npx prisma studio
```

### Testing & Quality
```bash
# Run linting
npx eslint .

# Type checking
npx vue-tsc --noEmit

# Build for production
pnpm build
```

## Key Patterns & Conventions

### API Routes
- Place in `server/api/` directory
- Use RESTful naming: `users.get.ts`, `users.post.ts`
- Return consistent JSON responses
- Handle errors gracefully with proper HTTP status codes

### Components
- Use PascalCase for component names
- Prefer `<script setup>` syntax
- Use TypeScript interfaces for props
- Keep components focused and reusable

### Database
- Use Prisma schema for all database changes
- Create migrations for schema changes
- Use type-safe database queries
- Follow naming conventions: camelCase for fields

### Environment Variables
- Define in `.env.example` with documentation
- Use `NUXT_` prefix for public variables
- Keep sensitive data server-side only

## Testing Guidelines

### When Testing APIs
1. Start development server in background: `pnpm dev &`
2. Use curl or testing scripts
3. Clean up test data and temporary files
4. Stop background server when done: `pkill -f "pnpm dev"`

### Cleanup After Testing
- Remove test files and scripts
- Clean up database test data
- Remove temporary environment variables
- Ensure no background processes are left running

## Common Tasks

### Adding New Features
1. Create database schema changes in Prisma
2. Generate and apply migrations
3. Create API endpoints in `server/api/`
4. Build Vue components in `app/components/`
5. Add pages in `app/pages/`
6. Update types and interfaces

### Debugging
- Use Vue DevTools for frontend debugging
- Check server logs for API issues
- Use Prisma Studio for database inspection
- Enable sourcemaps for better error traces

## Best Practices

### Performance
- Use lazy loading for large components
- Implement proper caching strategies
- Optimize database queries
- Use efficient Vue reactivity patterns

### Security
- Validate all user inputs
- Use proper authentication middleware
- Sanitize database queries
- Keep sensitive data server-side

### Maintainability
- Write tests for critical functionality
- Document complex business logic
- Use consistent error handling
- Keep dependencies up to date

## Market Data Worker
- Configurable update intervals (minimum 15 seconds)
- Batch processing for Yahoo Finance API
- Automatic error recovery and retry logic
- Environment variable: `MARKET_DATA_UPDATE_INTERVAL_MINUTES`

## Quick Reference

### Important Files
- `nuxt.config.ts` - Main configuration
- `prisma/schema.prisma` - Database schema
- `app.vue` - Root application component
- `.env.example` - Environment variables template

### Key Dependencies
- `@prisma/client` - Database ORM
- `@nuxtjs/kinde` - Authentication
- `@nuxtjs/tailwindcss` - Styling
- `@pinia/nuxt` - State management
- `zod` - Runtime type validation

Remember: Keep solutions simple, clean up after testing, and use background mode (`pnpm dev &`) when running shell scripts or API tests.
